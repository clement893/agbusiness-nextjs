# AG Business Advisory - Railway Deployment Guide

## Quick Start

### 1. Create Railway Project
1. Go to [railway.app](https://railway.app)
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose `clement893/agbusiness-nextjs`

### 2. Add PostgreSQL Database
1. In your Railway project, click "New"
2. Select "Database" → "PostgreSQL"
3. Railway will automatically create `DATABASE_URL` variable

### 3. Configure Environment Variables
Go to your Next.js service → Variables tab and add:

```env
# Auto-generated by Railway PostgreSQL
DATABASE_URL=postgresql://...

# Generate with: openssl rand -base64 32
NEXTAUTH_SECRET=your-generated-secret-here

# Your Railway app URL (e.g., https://agbusiness-production.up.railway.app)
NEXTAUTH_URL=https://your-app.up.railway.app

# Email configuration for NextAuth (optional for now)
EMAIL_SERVER=smtp://username:password@smtp.example.com:587
EMAIL_FROM=noreply@agbusinessadvisory.com
```

### 4. Run Database Migrations
In Railway, go to your Next.js service → Settings → Deploy:
- Add custom build command: `pnpm install && pnpm db:push`
- Or run manually after first deploy: `pnpm db:push`

### 5. Deploy!
Railway will automatically deploy when you push to GitHub.

## Environment Variables Details

### Required
- `DATABASE_URL` - Auto-generated by Railway PostgreSQL
- `NEXTAUTH_SECRET` - Generate with `openssl rand -base64 32`
- `NEXTAUTH_URL` - Your Railway app URL

### Optional (for production)
- `EMAIL_SERVER` - SMTP server for email authentication
- `EMAIL_FROM` - Sender email address

## Database Schema
The project uses Drizzle ORM with these tables:
- `users` - User accounts and authentication
- `categories` - Blog/content categories  
- `content` - Blog posts and pages

## Post-Deployment

### Create Admin User
After first deployment, you'll need to manually set a user's role to 'admin' in the database:

```sql
UPDATE users SET role = 'admin' WHERE email = 'your-email@example.com';
```

### Test Authentication
Visit `/api/auth/signin` to test the authentication flow.

## Troubleshooting

### Build Fails
- Check that all environment variables are set
- Ensure `DATABASE_URL` is accessible from Railway

### Database Connection Issues
- Verify `DATABASE_URL` format is correct
- Check Railway PostgreSQL service is running
- Run `pnpm db:push` to create tables

### Authentication Not Working
- Verify `NEXTAUTH_SECRET` is set
- Check `NEXTAUTH_URL` matches your Railway domain
- For email auth, verify `EMAIL_SERVER` credentials

## GitHub Workflows
The project includes GitHub Actions workflows in `.github/workflows/`:
- `lint.yml` - Code quality checks
- `deploy.yml` - Automated deployment

## Support
For issues, check:
- Railway logs in the deployment dashboard
- Next.js documentation: https://nextjs.org/docs
- Drizzle ORM: https://orm.drizzle.team
- NextAuth.js: https://next-auth.js.org
